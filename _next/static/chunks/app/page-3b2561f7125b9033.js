(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{217:(e,t,a)=>{"use strict";a.d(t,{ErrorBoundary:()=>i});var r=a(5942),s=a(4166);class i extends s.Component{static getDerivedStateFromError(e){return{hasError:!0,error:e}}componentDidCatch(e,t){console.error("ErrorBoundary caught an error:",e,t)}render(){return this.state.hasError?this.props.fallback?this.props.fallback:(0,r.jsx)("div",{className:"min-h-screen bg-gray-50 dark:bg-gray-900 flex items-center justify-center",children:(0,r.jsxs)("div",{className:"text-center p-8",children:[(0,r.jsx)("div",{className:"text-red-500 text-6xl mb-4",children:"⚠️"}),(0,r.jsx)("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white mb-4",children:"Something went wrong"}),(0,r.jsx)("p",{className:"text-gray-600 dark:text-gray-400 mb-6",children:"We're sorry, but something unexpected happened. Please refresh the page to try again."}),(0,r.jsx)("button",{onClick:()=>window.location.reload(),className:"px-6 py-3 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition-colors",children:"Refresh Page"})]})}):this.props.children}constructor(e){super(e),this.state={hasError:!1}}}},2302:(e,t,a)=>{"use strict";a.d(t,{TL:()=>i,ES:()=>r,Uv:()=>s});let r={en:{translation:JSON.parse('{"appName":"NutriLoop","appSubtitle":"Food Tracking Made Simple","loading":"Loading NutriLoop...","showSettings":"Show Settings","hideSettings":"Hide Settings","addFood":"Add Food","foodName":"Food Name","foodNamePlaceholder":"e.g., Apple, Chicken breast, Rice","weight":"Weight","weightPlaceholder":"e.g., 100","preview":"Preview","gettingInfo":"Getting Info...","adding":"Adding...","nutritionPreview":"Nutrition Preview","calories":"Calories","fat":"Fat","protein":"Protein","carbs":"Carbs","dailyProgress":"Daily Progress","dailyGoal":"% of daily goal","over":"over","todaysFoodLog":"Today\'s Food Log","noFoodEntries":"No food entries yet today.","addFirstMeal":"Add your first meal above!","items":"items","dailyLimits":"Daily Limits","saveLimits":"Save Limits","saving":"Saving...","kcal":"kcal","grams":"g","milliliters":"ml","enterBothFields":"Please enter both food name and weight","enterValidWeight":"Please enter a valid weight","failedToGetNutrition":"Failed to get nutrition info","failedToAddFood":"Failed to add food entry","failedToLoadLimits":"Failed to load daily limits","failedToSaveLimits":"Failed to save daily limits","failedToDeleteEntry":"Failed to delete food entry","dateFormat":{"weekday":"long","year":"numeric","month":"long","day":"numeric"}}')},zh:{translation:JSON.parse('{"appName":"营养环","appSubtitle":"简单的食物追踪","loading":"正在加载营养环...","showSettings":"显示设置","hideSettings":"隐藏设置","addFood":"添加食物","foodName":"食物名称","foodNamePlaceholder":"例如：苹果、鸡胸肉、米饭","weight":"重量","weightPlaceholder":"例如：100","preview":"预览","gettingInfo":"获取信息中...","adding":"添加中...","nutritionPreview":"营养预览","calories":"卡路里","fat":"脂肪","protein":"蛋白质","carbs":"碳水化合物","dailyProgress":"每日进度","dailyGoal":"% 每日目标","over":"超出","todaysFoodLog":"今日食物记录","noFoodEntries":"今天还没有食物记录。","addFirstMeal":"在上方添加您的第一餐！","items":"项","dailyLimits":"每日限额","saveLimits":"保存限额","saving":"保存中...","kcal":"千卡","grams":"克","milliliters":"毫升","enterBothFields":"请输入食物名称和重量","enterValidWeight":"请输入有效的重量","failedToGetNutrition":"获取营养信息失败","failedToAddFood":"添加食物记录失败","failedToLoadLimits":"加载每日限额失败","failedToSaveLimits":"保存每日限额失败","failedToDeleteEntry":"删除食物记录失败","dateFormat":{"weekday":"long","year":"numeric","month":"long","day":"numeric"}}')}},s=["en","zh"],i={en:{name:"English",nativeName:"English"},zh:{name:"Chinese",nativeName:"中文"}}},4125:(e,t,a)=>{Promise.resolve().then(a.bind(a,8156)),Promise.resolve().then(a.bind(a,217))},8156:(e,t,a)=>{"use strict";a.d(t,{Dashboard:()=>W});var r=a(5942),s=a(2127);class i{async init(){this.db||(this.db=await (0,s.P2)("nutriloop-db",2,{upgrade(e,t){t<1&&(e.createObjectStore("foodEntries",{keyPath:"id"}).createIndex("by-date","date"),e.createObjectStore("dailyLimits",{keyPath:"id"}),e.createObjectStore("foodCache",{keyPath:"id"}).createIndex("by-name","name"))}}))}async addFoodEntry(e){await this.init();let t={...e,id:crypto.randomUUID(),createdAt:new Date};return await this.db.add("foodEntries",t),t}async getFoodEntriesByDate(e){return await this.init(),(await this.db.getAllFromIndex("foodEntries","by-date",e)).map(e=>e.unit?e:{...e,unit:"g"})}async deleteFoodEntry(e){await this.init(),await this.db.delete("foodEntries",e)}async getDailyLimits(){await this.init();let e=await this.db.get("dailyLimits","default");if(e){let{...t}=e;return t}return{calories:2e3,fat:65,protein:150,carbs:250}}async setDailyLimits(e){await this.init();let t={...e,id:"default"};await this.db.put("dailyLimits",t)}async getCachedFood(e){return await this.init(),(await this.db.getAllFromIndex("foodCache","by-name",e.toLowerCase()))[0]}async cacheFood(e){await this.init();let t={...e,id:crypto.randomUUID(),name:e.name.toLowerCase(),lastUsed:new Date};await this.db.put("foodCache",t)}async getAllFoodEntries(){return await this.init(),(await this.db.getAll("foodEntries")).map(e=>e.unit?e:{...e,unit:"g"})}constructor(){this.db=null}}let n=new i;var l=a(8979),o=a(1322);function d(){for(var e=arguments.length,t=Array(e),a=0;a<e;a++)t[a]=arguments[a];return(0,o.QP)((0,l.$)(t))}function c(){return new Date().toISOString().split("T")[0]}function m(e,t){return"kcal"===t?"".concat(Math.round(e)," ").concat(t):"".concat(e.toFixed(1),"g")}var h=a(4166),g=a(4255);let u=h.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.jsx)("div",{ref:t,className:d("rounded-lg border border-gray-200 bg-white text-gray-950 shadow-sm dark:border-gray-800 dark:bg-gray-950 dark:text-gray-50",a),...s})});u.displayName="Card";let x=h.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.jsx)("div",{ref:t,className:d("flex flex-col space-y-1.5 p-6",a),...s})});x.displayName="CardHeader";let f=h.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.jsx)("h3",{ref:t,className:d("text-2xl font-semibold leading-none tracking-tight",a),...s})});f.displayName="CardTitle",h.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.jsx)("p",{ref:t,className:d("text-sm text-gray-500 dark:text-gray-400",a),...s})}).displayName="CardDescription";let b=h.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.jsx)("div",{ref:t,className:d("p-6 pt-0",a),...s})});b.displayName="CardContent",h.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.jsx)("div",{ref:t,className:d("flex items-center p-6 pt-0",a),...s})}).displayName="CardFooter";let y=(0,a(6619).F)("inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium ring-offset-white transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-blue-500 focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 dark:ring-offset-gray-950 dark:focus-visible:ring-blue-400",{variants:{variant:{default:"bg-blue-600 text-white hover:bg-blue-700 dark:bg-blue-600 dark:hover:bg-blue-700",destructive:"bg-red-600 text-white hover:bg-red-700 dark:bg-red-600 dark:hover:bg-red-700",outline:"border border-gray-200 bg-white hover:bg-gray-100 hover:text-gray-900 dark:border-gray-800 dark:bg-gray-950 dark:hover:bg-gray-800 dark:hover:text-gray-50",secondary:"bg-gray-100 text-gray-900 hover:bg-gray-200 dark:bg-gray-800 dark:text-gray-50 dark:hover:bg-gray-700",ghost:"hover:bg-gray-100 hover:text-gray-900 dark:hover:bg-gray-800 dark:hover:text-gray-50",link:"text-blue-600 underline-offset-4 hover:underline dark:text-blue-400"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),p=h.forwardRef((e,t)=>{let{className:a,variant:s,size:i,...n}=e;return(0,r.jsx)("button",{className:d(y({variant:s,size:i,className:a})),ref:t,...n})});p.displayName="Button";let v=h.forwardRef((e,t)=>{let{className:a,type:s,...i}=e;return(0,r.jsx)("input",{type:s,className:d("flex h-10 w-full rounded-md border border-gray-200 bg-white px-3 py-2 text-sm ring-offset-white file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-gray-500 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-blue-500 focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 dark:border-gray-800 dark:bg-gray-950 dark:ring-offset-gray-950 dark:placeholder:text-gray-400 dark:focus-visible:ring-blue-400",a),ref:t,...i})});v.displayName="Input";var N=a(6771),j=a(379);function w(e){let{initialLimits:t,onLimitsUpdated:a}=e,{t:s}=(0,g.Bd)(),[i,l]=(0,h.useState)(t),[o,d]=(0,h.useState)(!1);(0,h.useEffect)(()=>{l(t)},[t]);let c=async()=>{d(!0);try{await n.setDailyLimits(i),a()}catch(e){console.error(s("failedToSaveLimits"),e)}finally{d(!1)}},m=(e,t)=>{let a=parseFloat(t);!isNaN(a)&&a>=0&&l(t=>({...t,[e]:a}))};return(0,r.jsxs)(u,{children:[(0,r.jsx)(x,{children:(0,r.jsxs)(f,{className:"flex items-center gap-2",children:[(0,r.jsx)(N.A,{className:"h-5 w-5"}),s("dailyLimits")]})}),(0,r.jsxs)(b,{className:"space-y-4",children:[(0,r.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsxs)("label",{htmlFor:"calories",className:"block text-sm font-medium mb-1",children:[s("calories")," (",s("kcal"),")"]}),(0,r.jsx)(v,{id:"calories",type:"number",value:i.calories,onChange:e=>m("calories",e.target.value),min:"0",step:"1"})]}),(0,r.jsxs)("div",{children:[(0,r.jsxs)("label",{htmlFor:"fat",className:"block text-sm font-medium mb-1",children:[s("fat")," (",s("grams"),")"]}),(0,r.jsx)(v,{id:"fat",type:"number",value:i.fat,onChange:e=>m("fat",e.target.value),min:"0",step:"0.1"})]}),(0,r.jsxs)("div",{children:[(0,r.jsxs)("label",{htmlFor:"protein",className:"block text-sm font-medium mb-1",children:[s("protein")," (",s("grams"),")"]}),(0,r.jsx)(v,{id:"protein",type:"number",value:i.protein,onChange:e=>m("protein",e.target.value),min:"0",step:"0.1"})]}),(0,r.jsxs)("div",{children:[(0,r.jsxs)("label",{htmlFor:"carbs",className:"block text-sm font-medium mb-1",children:[s("carbs")," (",s("grams"),")"]}),(0,r.jsx)(v,{id:"carbs",type:"number",value:i.carbs,onChange:e=>m("carbs",e.target.value),min:"0",step:"0.1"})]})]}),(0,r.jsx)(p,{onClick:c,disabled:o,className:"w-full",children:o?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(j.A,{className:"mr-2 h-4 w-4"}),s("saving")]}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(j.A,{className:"mr-2 h-4 w-4"}),s("saveLimits")]})})]})]})}let k=h.forwardRef((e,t)=>{let{className:a,children:s,...i}=e;return(0,r.jsx)("select",{className:d("flex h-10 w-full rounded-md border border-gray-200 bg-white px-3 py-2 text-sm ring-offset-white focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-blue-500 focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 dark:border-gray-800 dark:bg-gray-950 dark:ring-offset-gray-950 dark:focus-visible:ring-blue-400",a),ref:t,...i,children:s})});k.displayName="Select";var F=a(1176);class S{initOpenAI(){if(!this.openai){let e="sk-MvhgfLb4PtcOsb1TrL5xUig1HCuOeHsM6s5s6ICRDCTq2jHm",t="https://api.chatanywhere.tech/v1";if(!e)throw Error("OpenAI API key not found. Please set NEXT_PUBLIC_OPENAI_API_KEY environment variable.");if(!t)throw Error("OpenAI base URL not found. Please set NEXT_PUBLIC_OPENAI_BASE_URL environment variable.");this.openai=new F.Ay({apiKey:e,baseURL:t,dangerouslyAllowBrowser:!0})}return this.openai}async getNutritionInfo(e,t,a){let r="".concat(e.toLowerCase(),"_").concat(a),s=await n.getCachedFood(r);if(s)return this.calculateNutritionForWeight(s.nutritionPer100g,t);let i=await this.fetchNutritionFromOpenAI(e,a);return await n.cacheFood({name:r,nutritionPer100g:i}),this.calculateNutritionForWeight(i,t)}async fetchNutritionFromOpenAI(e,t){let a=this.initOpenAI(),r="g"===t?"grams":"milliliters",s="ml"===t?" (Note: This is a liquid, so consider density and liquid-specific nutritional properties)":" (Note: This is a solid food)",i='\nPlease provide the nutritional information for "'.concat(e,'" per 100 ').concat(r).concat(s,'.\nReturn ONLY a JSON object with the following structure (no additional text):\n{\n  "calories": number,\n  "fat": number,\n  "protein": number,\n  "carbs": number\n}\n\nWhere:\n- calories: total calories per 100').concat(t,"\n- fat: total fat in grams per 100").concat(t,"\n- protein: total protein in grams per 100").concat(t,"\n- carbs: total carbohydrates in grams per 100").concat(t,"\n\nUse standard nutritional values for common foods. If the food is not recognized, provide reasonable estimates based on similar foods.\nFor liquids (ml), consider the actual density and nutritional content per volume.\nFor solids (g), use standard weight-based nutritional values.\n");try{var n,l;let e=null==(l=(await a.chat.completions.create({model:"gpt-3.5-turbo",messages:[{role:"user",content:i}],temperature:.1,max_tokens:200})).choices[0])||null==(n=l.message)?void 0:n.content;if(!e)throw Error("No response from OpenAI");let t=JSON.parse(e);if("number"!=typeof t.calories||"number"!=typeof t.fat||"number"!=typeof t.protein||"number"!=typeof t.carbs)throw Error("Invalid nutrition data format");return t}catch(e){return console.error("Error fetching nutrition from OpenAI:",e),{calories:100,fat:1,protein:5,carbs:20}}}calculateNutritionForWeight(e,t){let a=t/100;return{calories:Math.round(e.calories*a),fat:Math.round(e.fat*a*10)/10,protein:Math.round(e.protein*a*10)/10,carbs:Math.round(e.carbs*a*10)/10}}constructor(){this.openai=null}}let A=new S;var E=a(2042),L=a(9202),C=a(8344),P=a(6779);function I(e){let{onFoodAdded:t}=e,{t:a}=(0,g.Bd)(),[s,i]=(0,h.useState)(""),[l,o]=(0,h.useState)(""),[d,y]=(0,h.useState)("g"),[N,j]=(0,h.useState)(!1),[w,F]=(0,h.useState)(!1),[S,I]=(0,h.useState)(""),[T,D]=(0,h.useState)(null),O=async()=>{if(!s.trim()||!l.trim())return void I(a("enterBothFields"));let e=parseFloat(l);if(isNaN(e)||e<=0)return void I(a("enterValidWeight"));F(!0),I("");try{let t=await A.getNutritionInfo(s.trim(),e,d);D(t)}catch(e){I(e instanceof Error?e.message:a("failedToGetNutrition"))}finally{F(!1)}},B=async e=>{if(e.preventDefault(),!s.trim()||!l.trim())return void I(a("enterBothFields"));let r=parseFloat(l);if(isNaN(r)||r<=0)return void I(a("enterValidWeight"));j(!0),I("");try{let e;e=T||await A.getNutritionInfo(s.trim(),r,d),await n.addFoodEntry({name:s.trim(),weight:r,unit:d,nutrition:e,date:c()}),i(""),o(""),y("g"),D(null),t()}catch(e){I(e instanceof Error?e.message:a("failedToAddFood"))}finally{j(!1)}},M=(e,t)=>{"name"===e?i(t):"weight"===e?o(t):"unit"===e&&y(t),T&&D(null)};return(0,r.jsxs)(u,{children:[(0,r.jsx)(x,{children:(0,r.jsxs)(f,{className:"flex items-center gap-2",children:[(0,r.jsx)(E.A,{className:"h-5 w-5"}),a("addFood")]})}),(0,r.jsx)(b,{children:(0,r.jsxs)("form",{onSubmit:B,className:"space-y-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{htmlFor:"food-name",className:"block text-sm font-medium mb-1",children:a("foodName")}),(0,r.jsx)(v,{id:"food-name",type:"text",placeholder:a("foodNamePlaceholder"),value:s,onChange:e=>M("name",e.target.value),disabled:N||w})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{htmlFor:"weight",className:"block text-sm font-medium mb-1",children:a("weight")}),(0,r.jsxs)("div",{className:"flex gap-2",children:[(0,r.jsx)(v,{id:"weight",type:"number",placeholder:a("weightPlaceholder"),value:l,onChange:e=>M("weight",e.target.value),disabled:N||w,min:"0",step:"0.1",className:"flex-1"}),(0,r.jsxs)(k,{value:d,onChange:e=>M("unit",e.target.value),disabled:N||w,className:"w-20",children:[(0,r.jsx)("option",{value:"g",children:a("grams")}),(0,r.jsx)("option",{value:"ml",children:a("milliliters")})]})]})]}),T&&(0,r.jsxs)("div",{className:"p-4 bg-green-50 border border-green-200 rounded-lg dark:bg-green-900/20 dark:border-green-800",children:[(0,r.jsxs)("h4",{className:"font-medium text-green-800 dark:text-green-200 mb-2 flex items-center gap-2",children:[(0,r.jsx)(L.A,{className:"h-4 w-4"}),a("nutritionPreview")]}),(0,r.jsxs)("div",{className:"grid grid-cols-2 sm:grid-cols-4 gap-2 text-sm",children:[(0,r.jsxs)("div",{className:"text-center",children:[(0,r.jsx)("div",{className:"font-medium text-green-700 dark:text-green-300",children:m(T.calories,"kcal")}),(0,r.jsx)("div",{className:"text-green-600 dark:text-green-400",children:a("calories")})]}),(0,r.jsxs)("div",{className:"text-center",children:[(0,r.jsx)("div",{className:"font-medium text-green-700 dark:text-green-300",children:m(T.fat,"g")}),(0,r.jsx)("div",{className:"text-green-600 dark:text-green-400",children:a("fat")})]}),(0,r.jsxs)("div",{className:"text-center",children:[(0,r.jsx)("div",{className:"font-medium text-green-700 dark:text-green-300",children:m(T.protein,"g")}),(0,r.jsx)("div",{className:"text-green-600 dark:text-green-400",children:a("protein")})]}),(0,r.jsxs)("div",{className:"text-center",children:[(0,r.jsx)("div",{className:"font-medium text-green-700 dark:text-green-300",children:m(T.carbs,"g")}),(0,r.jsx)("div",{className:"text-green-600 dark:text-green-400",children:a("carbs")})]})]})]}),S&&(0,r.jsx)("div",{className:"text-red-600 text-sm",children:S}),(0,r.jsxs)("div",{className:"flex gap-2",children:[(0,r.jsx)(p,{type:"button",variant:"outline",onClick:O,disabled:N||w||!s.trim()||!l.trim(),className:"flex-1",children:w?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(C.A,{className:"mr-2 h-4 w-4 animate-spin"}),a("gettingInfo")]}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(P.A,{className:"mr-2 h-4 w-4"}),a("preview")]})}),(0,r.jsx)(p,{type:"submit",disabled:N||w,className:"flex-1",children:N?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(C.A,{className:"mr-2 h-4 w-4 animate-spin"}),a("adding")]}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(E.A,{className:"mr-2 h-4 w-4"}),a("addFood")]})})]})]})})]})}var T=a(2986),D=a(3083);function O(e){let{entries:t,onEntryDeleted:a}=e,{t:s,ready:i}=(0,g.Bd)();if(!i)return null;let l=async e=>{try{await n.deleteFoodEntry(e),a()}catch(e){console.error(s("failedToDeleteEntry"),e)}},o=Array.isArray(t)?t:[];return 0===o.length?(0,r.jsxs)(u,{children:[(0,r.jsx)(x,{children:(0,r.jsxs)(f,{className:"flex items-center gap-2",children:[(0,r.jsx)(T.A,{className:"h-5 w-5"}),s("todaysFoodLog")]})}),(0,r.jsx)(b,{children:(0,r.jsxs)("div",{className:"text-center py-8 text-gray-500",children:[(0,r.jsx)(T.A,{className:"h-12 w-12 mx-auto mb-4 opacity-50"}),(0,r.jsx)("p",{children:s("noFoodEntries")}),(0,r.jsx)("p",{className:"text-sm",children:s("addFirstMeal")})]})})]}):(0,r.jsxs)(u,{children:[(0,r.jsx)(x,{children:(0,r.jsxs)(f,{className:"flex items-center gap-2",children:[(0,r.jsx)(T.A,{className:"h-5 w-5"}),s("todaysFoodLog")," (",o.length," ",s("items"),")"]})}),(0,r.jsx)(b,{children:(0,r.jsx)("div",{className:"space-y-3",children:o.map(e=>(0,r.jsxs)("div",{className:"flex items-center justify-between p-4 border border-gray-200 rounded-lg hover:bg-gray-50 dark:border-gray-700 dark:hover:bg-gray-800",children:[(0,r.jsxs)("div",{className:"flex-1",children:[(0,r.jsxs)("div",{className:"flex items-center gap-2 mb-1",children:[(0,r.jsx)("h4",{className:"font-medium capitalize",children:e.name}),(0,r.jsxs)("span",{className:"text-sm text-gray-500",children:["(",e.weight,e.unit,")"]})]}),(0,r.jsxs)("div",{className:"grid grid-cols-2 sm:grid-cols-4 gap-2 text-sm text-gray-600",children:[(0,r.jsx)("span",{children:m(e.nutrition.calories,"kcal")}),(0,r.jsxs)("span",{children:[m(e.nutrition.fat,"g")," fat"]}),(0,r.jsxs)("span",{children:[m(e.nutrition.protein,"g")," protein"]}),(0,r.jsxs)("span",{children:[m(e.nutrition.carbs,"g")," carbs"]})]})]}),(0,r.jsx)(p,{variant:"ghost",size:"icon",onClick:()=>l(e.id),className:"text-red-500 hover:text-red-700 hover:bg-red-50",children:(0,r.jsx)(D.A,{className:"h-4 w-4"})})]},e.id))})})]})}var B=a(9763),M=a(2302);function R(){let{i18n:e}=(0,g.Bd)(),[t,a]=(0,h.useState)(!1),s=M.TL||{en:{name:"English",nativeName:"English"},zh:{name:"Chinese",nativeName:"中文"}},i=M.Uv||["en","zh"],n=t=>{e&&"function"==typeof e.changeLanguage&&e.changeLanguage(t),a(!1)};return(0,r.jsxs)("div",{className:"relative",children:[(0,r.jsx)("button",{onClick:()=>a(!t),className:"flex items-center justify-center w-8 h-8 rounded-md hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors","aria-label":"Change language",children:(0,r.jsx)(B.A,{className:"h-4 w-4 text-gray-600 dark:text-gray-400"})}),t&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("div",{className:"fixed inset-0 z-10",onClick:()=>a(!1)}),(0,r.jsx)("div",{className:"absolute right-0 top-full mt-1 z-20 bg-white dark:bg-gray-900 border border-gray-200 dark:border-gray-700 rounded-md shadow-lg min-w-[120px]",children:i.map(t=>{var a;return(0,r.jsx)("button",{onClick:()=>n(t),className:"w-full px-3 py-2 text-left text-sm hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors first:rounded-t-md last:rounded-b-md ".concat((null==e?void 0:e.language)===t?"bg-blue-50 dark:bg-blue-900/20 text-blue-600 dark:text-blue-400":"text-gray-700 dark:text-gray-300"),children:(null==(a=s[t])?void 0:a.nativeName)||t},t)})})]})]})}let _=h.forwardRef((e,t)=>{let{className:a,value:s,max:i=100,...n}=e,l=Math.min(Math.max(s/i*100,0),100);return(0,r.jsx)("div",{ref:t,className:d("relative h-4 w-full overflow-hidden rounded-full bg-gray-100 dark:bg-gray-800",a),...n,children:(0,r.jsx)("div",{className:"h-full w-full flex-1 bg-blue-600 transition-all dark:bg-blue-400",style:{transform:"translateX(-".concat(100-l,"%)")}})})});_.displayName="Progress";var U=a(831);function z(e){let{progress:t}=e,{t:a}=(0,g.Bd)(),s=[{name:a("calories"),key:"calories",unit:a("kcal"),color:"bg-blue-500"},{name:a("fat"),key:"fat",unit:a("grams"),color:"bg-yellow-500"},{name:a("protein"),key:"protein",unit:a("grams"),color:"bg-green-500"},{name:a("carbs"),key:"carbs",unit:a("grams"),color:"bg-purple-500"}];return(0,r.jsxs)(u,{children:[(0,r.jsx)(x,{children:(0,r.jsxs)(f,{className:"flex items-center gap-2",children:[(0,r.jsx)(U.A,{className:"h-5 w-5"}),a("dailyProgress")]})}),(0,r.jsx)(b,{className:"space-y-6",children:s.map(e=>{let s=t.consumed[e.key],i=t.limits[e.key],n=t.percentage[e.key];return(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsxs)("div",{className:"flex justify-between items-center",children:[(0,r.jsx)("span",{className:"font-medium",children:e.name}),(0,r.jsxs)("span",{className:"text-sm text-gray-600",children:[m(s,e.unit)," / ",m(i,e.unit)]})]}),(0,r.jsxs)("div",{className:"relative",children:[(0,r.jsx)(_,{value:s,max:i,className:"h-3"}),(0,r.jsx)("div",{className:"absolute top-0 left-0 h-3 rounded-full transition-all ".concat(e.color),style:{width:"".concat(Math.min(n,100),"%")}})]}),(0,r.jsxs)("div",{className:"flex justify-between text-xs text-gray-500",children:[(0,r.jsxs)("span",{children:[n,a("dailyGoal")]}),n>100&&(0,r.jsxs)("span",{className:"text-red-500 font-medium",children:[m(s-i,e.unit)," ",a("over")]})]})]},e.key)})})]})}function W(){let{t:e}=(0,g.Bd)(),[t,a]=(0,h.useState)([]),[s,i]=(0,h.useState)(null),[l,o]=(0,h.useState)(null),[d,m]=(0,h.useState)(!0),[u,x]=(0,h.useState)(!1),[f,b]=(0,h.useState)(null);(0,h.useEffect)(()=>{y()},[]);let y=async()=>{m(!0);try{let e=c(),[t,r]=await Promise.all([n.getFoodEntriesByDate(e),n.getDailyLimits()]),s=Array.isArray(t)?t:[];a(s),i(r),o(function(e,t){let a=e.reduce((e,t)=>({calories:e.calories+t.nutrition.calories,fat:e.fat+t.nutrition.fat,protein:e.protein+t.nutrition.protein,carbs:e.carbs+t.nutrition.carbs}),{calories:0,fat:0,protein:0,carbs:0}),r={calories:Math.round(a.calories/t.calories*100),fat:Math.round(a.fat/t.fat*100),protein:Math.round(a.protein/t.protein*100),carbs:Math.round(a.carbs/t.carbs*100)};return{consumed:a,limits:t,percentage:r}}(s,r)),b(null)}catch(e){console.error("Failed to load data:",e),b("Failed to load data. Please refresh the page."),a([]),i(null),o(null)}finally{m(!1)}};return d?(0,r.jsx)("div",{className:"min-h-screen bg-gray-50 dark:bg-gray-900 flex items-center justify-center",children:(0,r.jsxs)("div",{className:"text-center",children:[(0,r.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),(0,r.jsx)("p",{className:"text-gray-600 dark:text-gray-400",children:e("loading")})]})}):f?(0,r.jsx)("div",{className:"min-h-screen bg-gray-50 dark:bg-gray-900 flex items-center justify-center",children:(0,r.jsxs)("div",{className:"text-center",children:[(0,r.jsx)("div",{className:"text-red-500 text-xl mb-4",children:"⚠️"}),(0,r.jsx)("p",{className:"text-red-600 dark:text-red-400 mb-4",children:f}),(0,r.jsx)("button",{onClick:()=>{b(null),y()},className:"px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600",children:"Retry"})]})}):(0,r.jsx)("div",{className:"min-h-screen bg-gray-50 dark:bg-gray-900",children:(0,r.jsxs)("div",{className:"container mx-auto px-4 py-8 max-w-4xl",children:[(0,r.jsx)("div",{className:"mb-8",children:(0,r.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,r.jsx)("div",{className:"flex-1"}),(0,r.jsxs)("div",{className:"text-center",children:[(0,r.jsx)("h1",{className:"text-3xl font-bold text-gray-900 dark:text-white mb-2",children:e("appName")}),(0,r.jsx)("p",{className:"text-gray-600 dark:text-gray-400",children:new Date(c()).toLocaleDateString("en-US",{weekday:"long",year:"numeric",month:"long",day:"numeric"})})]}),(0,r.jsx)("div",{className:"flex-1 flex justify-end",children:(0,r.jsx)(R,{})})]})}),(0,r.jsx)("div",{className:"mb-6 text-center",children:(0,r.jsx)("button",{onClick:()=>x(!u),className:"text-blue-600 hover:text-blue-800 dark:text-blue-400 dark:hover:text-blue-300 text-sm font-medium",children:e(u?"hideSettings":"showSettings")})}),(0,r.jsxs)("div",{className:"space-y-6",children:[u&&s&&(0,r.jsx)(w,{initialLimits:s,onLimitsUpdated:()=>{y(),x(!1)}}),(0,r.jsx)(I,{onFoodAdded:()=>{y()}}),l&&(0,r.jsx)(z,{progress:l}),(0,r.jsx)(O,{entries:t,onEntryDeleted:()=>{y()}})]})]})})}}},e=>{var t=t=>e(e.s=t);e.O(0,[255,623,449,681,358],()=>t(4125)),_N_E=e.O()}]);